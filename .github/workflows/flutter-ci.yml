name: Build & Upload Flutter App

on:
  push:
    branches:
      - main

jobs:
  build-and-upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.35.4"

      - name: Install dependencies
        run: flutter pub get

      - name: Build APK
        run: flutter build apk --release

            - name: Notify Gmail
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.GMAIL_USERNAME }}
          password: ${{ secrets.GMAIL_PASSWORD }}
          from: ${{ needs.Get_Info.outputs.commit_author_email }}
          to: mdshadhinali.official@gmail.com
          subject: "CI 👉🏻 New APK Build Uploaded"
          convert_markdown: true
          body: |
            Dear Sir,

            I hope this email finds you well. I just wanted to let you know that a new APK build has been uploaded to our Google Drive.

            We are pleased to share the following details:

            - Project: ${{ needs.Get_Info.outputs.project_name }}
            - Branch: ${{ needs.Get_Info.outputs.branch_name }}
            - Date: ${{ needs.Get_Info.outputs.date_time }}

            You can download the APK build by clicking on the following link: 
             - 🔗 Google Drive Download Url: [Click Here](https://drive.google.com/drive/folders/${{needs.Get_Info.outputs.folder_id.value}})
             - 🔗 Transfer.sh Download Url: [Click Here](${{ needs.Upload_Apk.outputs.upload_url }})

            Should you have any questions or require further assistance, please do not hesitate to reach out to us. We value your continued support and look forward to serving you.

            Best regards,

            ${{ needs.Get_Info.outputs.commit_author }}
            Flutter Developer
            IX Solutions Company
            Email: ${{ needs.Get_Info.outputs.commit_author_email }}
